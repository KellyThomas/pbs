<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" rel='stylesheet'/>
</head>

<body>
  <div style='height: 30vh; overflow: auto;'>
    <h2>Embed html snippet</h2>
    <pre>&lt;script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'&gt;&lt;/script&gt;
&lt;link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' /&gt;
&lt;script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js'&gt;&lt;/script&gt;
&lt;link href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css' rel='stylesheet' /&gt;
&lt;div id='map' style='width: 100%; height: 70vh;'&gt;&lt;/div&gt;
&lt;script&gt;<span id="source"></span>&lt;/script&gt;</pre>
  </div>
  <div id='map' style='width: 100%; height: 70vh;'></div>
  <script id="app">
    mapboxgl.accessToken = 'pk.eyJ1IjoiZHBhd2FzaSIsImEiOiJja2loeXp2cnUyMjdoMnhwZW82eDhucG84In0.KlcGctisTvc4_Oso2OmY8w';
    var map = new mapboxgl.Map({
      container: 'map', style: 'mapbox://styles/dpawasi/ckigwmxrx606g19msw0g882gj',
      center: [115.9, -31.9], zoom: 9
    });
    map.addControl(new MapboxGeocoder({accessToken: mapboxgl.accessToken, mapboxgl: mapboxgl, bbox: [105.7,-38.5,130.5,-10.6]}));
    map.addControl(new mapboxgl.GeolocateControl());
    map.on('load', function () {
      // wms layer docs https://docs.mapbox.com/mapbox-gl-js/example/wms/
      map.addSource('todaysburns-raster', {
        'type': 'raster', tileSize: 256,
        'tiles': ['https://kmi.dbca.wa.gov.au/geoserver/public/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&FORMAT=image/png&TRANSPARENT=true&tiled=true&STYLES&LAYERS=public:yesterdays_burns,public:todays_burns&WIDTH=256&HEIGHT=256&SRS=EPSG:3857&BBOX={bbox-epsg-3857}']
      });
      map.addLayer({ 'id': 'todaysburns', 'type': 'raster', 'source': 'todaysburns-raster' });
      // poly layer with hover and popups
      map.addSource('todaysburns-poly', {
        'type': 'geojson', 'generateId': true,
        'data': 'https://kmi.dpaw.wa.gov.au/geoserver/wfs?service=wfs&version=2.0.0&request=GetFeature&outputFormat=application/json&typeNames=public:yesterdays_burns'
      });
      map.addLayer({
        'id': 'todaysburns-vector', 'type': 'fill', 'source': 'todaysburns-poly',
        'paint': {
          'fill-color': '#627BC1',
          'fill-opacity': ['case', ['boolean', ['feature-state', 'hover'], false], 0.3, 0]
        }
      });
      // hover docs https://docs.mapbox.com/mapbox-gl-js/example/hover-styles/
      var hoveredBurnId = null;
      map.on('mousemove', 'todaysburns-vector', function (e) {
        if (e.features.length > 0) {
          if (hoveredBurnId) { map.setFeatureState({ source: 'todaysburns-poly', id: hoveredBurnId }, { hover: false }); }
          hoveredBurnId = e.features[0].id;
          map.setFeatureState({ source: 'todaysburns-poly', id: hoveredBurnId }, { hover: true });
        }
      });
      map.on('mouseleave', 'todaysburns-vector', function () {
        if (hoveredBurnId) { map.setFeatureState({ source: 'todaysburns-poly', id: hoveredBurnId }, { hover: false }); }
        hoveredBurnId = null;
      });
      // popup docs https://docs.mapbox.com/mapbox-gl-js/example/polygon-popup-on-click/
      map.on('click', 'todaysburns-vector', function (e) {
        var popupHTML = JSON.stringify(e.features[0].properties);
        new mapboxgl.Popup().setLngLat(e.lngLat).setHTML(popupHTML).addTo(map);
      });

      // Change the cursor to a pointer when the mouse is over the burns vectors.
      map.on('mouseenter', 'todaysburns-vector', function () {
        map.getCanvas().style.cursor = 'pointer';
      });

      // Change it back to a pointer when it leaves.
      map.on('mouseleave', 'todaysburns-vector', function () {
        map.getCanvas().style.cursor = '';
      });
    });
  </script>
  <script>
    document.getElementById("source").innerText = document.getElementById("app").innerText
  </script>
</body>

</html>
